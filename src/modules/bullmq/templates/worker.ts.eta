import { Worker } from 'bullmq';
import queueConfig from '../queueDefinitions';

<% Object.entries(it.config.queues).forEach(([queueName, queueDef]) => { %>
<% Object.entries(queueDef.workers).forEach(([workerName, workerDef]) => { %>
export const <%= workerName %>Worker = new Worker(
    '<%= queueName %>',
    queueConfig.queues.<%= queueName %>.workers.<%= workerName %>.processor,
    {
        ...queueConfig.queues.<%= queueName %>.workers.<%= workerName %>.options,
        connection: queueConfig.connection,
    }
);

<% }); %>
<% }); %>

// Export all workers as array for WorkerManager
export const allWorkers = [
<% Object.entries(it.config.queues).forEach(([queueName, queueDef]) => { %>
<% Object.entries(queueDef.workers).forEach(([workerName, workerDef]) => { %>
    <%= workerName %>Worker,
<% }); %>
<% }); %>
];
